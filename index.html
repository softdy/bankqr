<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/assets/logo.a608dba9.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <link rel="manifest" href="data:application/json;base64,ewogICAgIm5hbWUiOiAiQmFua1FyIiwKICAgICJzaG9ydF9uYW1lIjogIkJhbmtRciIsCiAgICAic3RhcnRfdXJsIjogIi8iLAogICAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAgICJ0aGVtZV9jb2xvciI6ICIjMWUyOTNiIiwKICAgICJpY29ucyI6IFsKICAgICAgICB7CiAgICAgICAgICAgICJzcmMiOiAibG9nby5zdmciLAogICAgICAgICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJzcmMiOiAibG9nby5zdmciLAogICAgICAgICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICAgICAgfQogICAgXQp9" />
    <title>BankQr</title>
    <script type="module" crossorigin src="/assets/index.616c48e4.js"></script>
    <link rel="modulepreload" href="/assets/react-venders.fdd7a765.js">
    <link rel="stylesheet" href="/assets/index.4780111f.css">
  </head>
  <body style="margin: 0">
    <div id="root"></div>
    
    <script>
      const urlParams = new URLSearchParams(window.location.search)
      const isDebug = urlParams.get('debug')
      if (isDebug == 'true') {
        window.isDebug = true
      } else {
        window.isDebug = false
      }

      // Hàm để xử lý lỗi
      function handleError(event) {
        window.isDebug ? alert(event.message) : ''
      }

      // Lắng nghe tất cả các lỗi toàn cục
      window.addEventListener('error', handleError)

      // Lắng nghe lỗi trong Promise
      window.addEventListener('unhandledrejection', function (event) {
        if (event.reason instanceof Error) {
          window.isDebug
            ? alert(
                'Unhandled promise rejection: ' +
                  event.reason.message +
                  event.reason.stack,
              )
            : ''
        } else {
          window.isDebug
            ? alert('Unhandled promise rejection: ' + event.reason)
            : ''
        }
      })

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/service-worker.js')
            .then((registration) => {
              console.log(
                'Service Worker registered with scope:',
                registration.scope,
              )
              registration.onupdatefound = () => {
                const newWorker = registration.installing
                newWorker.onstatechange = () => {
                  if (
                    newWorker.state === 'installed' &&
                    navigator.serviceWorker.controller
                  ) {
                    // Nếu có bản cập nhật, yêu cầu cập nhật cache
                    newWorker.postMessage({ action: 'updateCache' })
                    newWorker.postMessage('skipWaiting') // Bỏ qua và sử dụng worker mới
                    location.reload()
                  }
                }
              }
            })
            .catch((error) => {
              if (window.isDebug) {
                alert(error.message)
              }
              console.error('Service Worker registration failed:', error)
            })
        })
      }
    </script>
  </body>
</html>
